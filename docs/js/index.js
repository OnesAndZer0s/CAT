import $ from"jquery";import ko from"knockout";import"knockout-mapping";import moment from"moment";import Highcharts from"highcharts";import _ from"underscore";import{toHHMMSS}from"./util.js";import{ActivityManager,ActivityTimer,Category,ActivityEditVM,ActivityMonitor,ActivityItemEdit}from"./activity.js";import{CATEGORIES}from"./consts.js";var pages,currentPageIndex,LASTPAGEINDEX,FIRSTPAGEINDEX=0,FADEINTERVAL=350,ACTIVITYSUBMISSIONTHRESHOLD=0;function showWizard(){$("#userInformation").fadeOut(FADEINTERVAL),$("#landing").fadeOut(FADEINTERVAL,(()=>{$(pages[FIRSTPAGEINDEX]).fadeIn(FADEINTERVAL);var t=0;$("#infoSidebar, #submissionPages, #sectionsContainer").fadeIn(FADEINTERVAL,(()=>{3==++t&&($("#panel1").show(),$("#panel2").hide(),$("#goNext, #goSave").show(),$("#goBack").hide(),currentPageIndex=FIRSTPAGEINDEX,$("#goBackMenu").addClass("disabled"),$("#goNextMenu, #saveMenu, #home").removeClass("disabled"),setSection(1),setTimeout((()=>{$(pages[FIRSTPAGEINDEX]).find("input.defaultfocus").focus()}),200))}))}))}function showLanding(){$(pages[currentPageIndex]).fadeOut(FADEINTERVAL);var t=0;$("#submissionPages, #sectionsContainer, #landing").fadeOut(FADEINTERVAL,(()=>{3==++t&&(loadSubmissionsList(),$("#landing").fadeIn(FADEINTERVAL,(()=>{$("#goBackMenu, #goNextMenu, #saveMenu").addClass("disabled"),$("#home").removeClass("disabled")})))}))}function showUserInformation(){$(pages[currentPageIndex]).fadeOut(FADEINTERVAL);var t=0;$("#submissionPages, #sectionsContainer, #landing, #needProfile").fadeOut(FADEINTERVAL,(()=>{4==++t&&$("#userInformation").fadeIn(FADEINTERVAL,(()=>{$("#goBackMenu, #goNextMenu, #saveMenu, #home").addClass("disabled"),$("#infoName").select()}))}))}function initLanding(){$("#goBackMenu, #goNextMenu, #saveMenu").addClass("disabled"),$(pages[currentPageIndex]).hide(),ActivityManager.currentSubmissionsList=new submissionsModel,loadSubmissionsList(),ko.applyBindings(ActivityManager.currentSubmissionsList,document.getElementById("landing")),setTimeout((()=>{$("#landingTable").fadeIn(FADEINTERVAL)}),FADEINTERVAL)}function loadSubmissionsList(){var t=JSON.parse(localStorage.getItem("Session")||"{}");ActivityManager.currentSubmissionsList.submissions(ko.utils.arrayMap(Object.keys(t),(e=>({submissionID:t[e].SubmissionID,name:`${t[e].Teacher} - ${t[e].Class}`,isSubmitted:t[e].IsSubmitted,lastUpdated:t[e].LastUpdated}))))}function saveVM(){var t=JSON.parse(localStorage.getItem("Session"));t[ActivityManager.currentVM.SubmissionID()]=JSON.parse(ko.toJSON(ActivityManager.currentVm)),localStorage.setItem("Session",JSON.stringify(t))}function timeRangeStandard(t){return{minTime:"standardEndTime"==t.id?$("#standardStartTime").timeEntry("getTime"):null,maxTime:"standardStartTime"==t.id?$("#standardEndTime").timeEntry("getTime"):null}}function timeRangeER(t){return{minTime:"erEndTime"==t.id?$("#erStartTime").timeEntry("getTime"):null,maxTime:"erStartTime"==t.id?$("#erEndTime").timeEntry("getTime"):null}}function createChart(){$("#weeklyChart").html(""),new Highcharts.Chart({chart:{renderTo:"weeklyChart",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"Weekly Minutes"},tooltip:{percentageDecimals:1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:[{type:"pie",name:"Time spent",data:[{name:"Academics / Academic Support",y:Math.round(10*ActivityManager.currentVM.D64())/10,sliced:!0,selected:!0,color:"#660066"},{name:"Specials / Electives",y:Math.round(10*ActivityManager.currentVM.H64())/10,color:"#6E8890"},{name:"Other",y:Math.round(10*ActivityManager.currentVM.L64())/10,color:"#7F866C"}]}]}),$("#annualChart").html(""),new Highcharts.Chart({chart:{renderTo:"annualChart",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"Annual Hours"},tooltip:{percentageDecimals:1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:[{type:"pie",name:"Time spent",data:[{name:"Academics / Academic Support",y:Math.round(10*ActivityManager.currentVM.D68())/10,sliced:!0,selected:!0,color:"#660066"},{name:"Specials / Electives",y:Math.round(10*ActivityManager.currentVM.H68())/10,color:"#6E8890"},{name:"Other",y:Math.round(10*ActivityManager.currentVM.L68())/10,color:"#7F866C"}]}]})}function isPageOneValid(){return!(0==$.trim(ActivityManager.currentVM.Phone()).length||0==$.trim(ActivityManager.currentVM.SchoolName()).length||0==$.trim(ActivityManager.currentVM.StreetAddress()).length||0==$.trim(ActivityManager.currentVM.City()).length||0==$.trim(ActivityManager.currentVM.State()).length||0==$.trim(ActivityManager.currentVM.Zip()).length||!(ActivityManager.currentVM.GradeECE()||ActivityManager.currentVM.GradeK()||ActivityManager.currentVM.Grade1()||ActivityManager.currentVM.Grade2()||ActivityManager.currentVM.Grade3()||ActivityManager.currentVM.Grade4()||ActivityManager.currentVM.Grade5()||ActivityManager.currentVM.Grade6()||ActivityManager.currentVM.Grade7()||ActivityManager.currentVM.Grade8()||ActivityManager.currentVM.Grade9()||ActivityManager.currentVM.Grade10()||ActivityManager.currentVM.Grade11()||ActivityManager.currentVM.Grade12()))}function navigate(t){if(saveVM(),0==currentPageIndex){if(!isPageOneValid())return $("#schoolReportDetails div.alert").fadeIn(FADEINTERVAL),!1;$("#schoolReportDetails div.alert").fadeOut(FADEINTERVAL)}$("#goBack, #goNext, #goSave").fadeOut(FADEINTERVAL),("panel1"==$(pages[t]).data("sidebar")&&"panel2"==$(pages[currentPageIndex]).data("sidebar")||"panel2"==$(pages[t]).data("sidebar")&&"panel1"==$(pages[currentPageIndex]).data("sidebar"))&&$(".panel").fadeOut(FADEINTERVAL),$(pages[currentPageIndex]).fadeOut(FADEINTERVAL,(()=>{t!=FIRSTPAGEINDEX?($("#goBack").fadeIn(FADEINTERVAL),$("#goBackMenu").removeClass("disabled")):$("#goBackMenu").addClass("disabled"),t!=LASTPAGEINDEX?($("#goNext").fadeIn(FADEINTERVAL),$("#goNextMenu").removeClass("disabled")):$("#goNextMenu").addClass("disabled"),$("#goSave").fadeIn(FADEINTERVAL),"panel1"!=$(pages[t]).data("sidebar")||$("#panel1").is(":visible")||$("#panel1").fadeIn(FADEINTERVAL),"panel2"!=$(pages[t]).data("sidebar")||$("#panel2").is(":visible")||$("#panel2").fadeIn(FADEINTERVAL),0==t?$(pages[t]).fadeIn(FADEINTERVAL,createChart):$(pages[t]).fadeIn(FADEINTERVAL),window.scrollTo(0,0),setSection($(pages[t]).attr("data-section")),$(pages[t]).find("input.defaultfocus").focus().select()})),currentPageIndex=t}function setSection(t){$("#sections li").removeClass("active"),$('#sections li[data-section="'+t+'"]').addClass("active")}function displayTime(t){return(t.getHours()>12?t.getHours()-12:t.getHours())+":"+(t.getMinutes()>9?t.getMinutes().toString():"0"+t.getMinutes().toString())+"Â "+(t.getHours()>12?"PM":"AM")}function displayNumberPct(t){return displayNumber(t,1,"% allocated time")}function displayNumber(t,e,i){null==e&&(e=0);var s=parseFloat(t);return isNaN(s)&&(s=0),null==i?s.toFixed(e):s.toFixed(e)+i}function parseNvPairString(t){var e={},i=t.split("&");return $.each(i,((t,i)=>{var s=i.split("=");e[s[0]]=s[1]})),e}function getTimeStamp(){var t=new Date,e=t.getTime(),i=-1*t.getTimezoneOffset()*6e4;return Math.round(new Date(e+i).getTime()/1e3)}function appViewModel(){this.SubmissionID=ko.observable(),this.Name=ko.observable(),this.IsSubmitted=ko.observable(),this.LastUpdated=ko.observable(),this.Phone=ko.observable(),this.SchoolName=ko.observable(),this.StreetAddress=ko.observable(),this.City=ko.observable(),this.State=ko.observable(),this.Zip=ko.observable(),this.GradeECE=ko.observable(),this.GradeK=ko.observable(),this.Grade1=ko.observable(),this.Grade2=ko.observable(),this.Grade3=ko.observable(),this.Grade4=ko.observable(),this.Grade5=ko.observable(),this.Grade6=ko.observable(),this.Grade7=ko.observable(),this.Grade8=ko.observable(),this.Grade9=ko.observable(),this.Grade10=ko.observable(),this.Grade11=ko.observable(),this.Grade12=ko.observable(),this.D5=ko.observable(new Date(1,1,1,8,0,0,0)),this.D6=ko.observable(new Date(1,1,1,15,0,0,0)),this.D8=ko.numericObservable(0),this.D10=ko.observable(new Date(1,1,1,8,0,0,0)),this.D11=ko.observable(new Date(1,1,1,15,0,0,0)),this.D13=ko.numericObservable(0),this.D16=ko.numericObservable(0),this.D17=ko.numericObservable(0),this.PeriodsPerDayStd=ko.numericObservable(0),this.MinutesPerPeriodStd=ko.numericObservable(0),this.PeriodsPerDayEr=ko.numericObservable(0),this.MinutesPerPeriodEr=ko.numericObservable(0),this.G8=ko.computed((()=>60*(this.D6().getHours()-this.D5().getHours())+(this.D6().getMinutes()-this.D5().getMinutes()))),this.G13=ko.computed((()=>60*(this.D11().getHours()-this.D10().getHours())+(this.D11().getMinutes()-this.D10().getMinutes()))),this.G15=ko.computed((()=>this.G8()*this.D8()+this.G13()*this.D13())),this.G17=ko.computed((()=>(this.D16()*this.G8()+this.D17()*this.G13())/60)),this.C23=ko.numericObservable(0),this.C24=ko.numericObservable(0),this.C25=ko.numericObservable(0),this.C26=ko.numericObservable(0),this.C27=ko.numericObservable(0),this.C28=ko.numericObservable(0),this.C28text=ko.observable("Other"),this.C30=ko.numericObservable(0),this.C31=ko.numericObservable(0),this.C32=ko.numericObservable(0),this.C33=ko.numericObservable(0),this.C33text=ko.observable("Other"),this.D23=ko.computed((()=>this.C23()/this.G15()*100)),this.D24=ko.computed((()=>this.C24()/this.G15()*100)),this.D25=ko.computed((()=>this.C25()/this.G15()*100)),this.D26=ko.computed((()=>this.C26()/this.G15()*100)),this.D27=ko.computed((()=>this.C27()/this.G15()*100)),this.D28=ko.computed((()=>this.C28()/this.G15()*100)),this.D30=ko.computed((()=>this.C30()/this.G15()*100)),this.D31=ko.computed((()=>this.C31()/this.G15()*100)),this.D32=ko.computed((()=>this.C32()/this.G15()*100)),this.D33=ko.computed((()=>this.C33()/this.G15()*100)),this.C22=ko.computed((()=>this.C23()+this.C24()+this.C25()+this.C26()+this.C27()+this.C28())),this.D22=ko.computed((()=>this.C22()/this.G15()*100)),this.C29=ko.computed((()=>this.C30()+this.C31()+this.C32()+this.C33())),this.D29=ko.computed((()=>this.C29()/this.G15()*100)),this.C35=ko.computed((()=>this.C29()+this.C22())),this.C36=ko.computed((()=>this.C35()/60)),this.D35=ko.computed((()=>this.C35()/this.G15()*100)),this.C37=ko.computed((()=>this.D35()*this.G17()/this.D16()/100)),this.G23=ko.numericObservable(0),this.G24=ko.numericObservable(0),this.G25=ko.numericObservable(0),this.G26=ko.numericObservable(0),this.G27=ko.numericObservable(0),this.G27text=ko.observable("Other"),this.G28=ko.numericObservable(0),this.G28text=ko.observable("Other"),this.G30=ko.numericObservable(0),this.G31=ko.numericObservable(0),this.G32=ko.numericObservable(0),this.G32text=ko.observable("Other"),this.H23=ko.computed((()=>this.G23()/this.G15()*100)),this.H24=ko.computed((()=>this.G24()/this.G15()*100)),this.H25=ko.computed((()=>this.G25()/this.G15()*100)),this.H26=ko.computed((()=>this.G26()/this.G15()*100)),this.H27=ko.computed((()=>this.G27()/this.G15()*100)),this.H28=ko.computed((()=>this.G28()/this.G15()*100)),this.H30=ko.computed((()=>this.G30()/this.G15()*100)),this.H31=ko.computed((()=>this.G31()/this.G15()*100)),this.H32=ko.computed((()=>this.G32()/this.G15()*100)),this.G22=ko.computed((()=>this.G23()+this.G24()+this.G25()+this.G26()+this.G27()+this.G28())),this.H22=ko.computed((()=>this.G22()/this.G15()*100)),this.G29=ko.computed((()=>this.G30()+this.G31()+this.G32())),this.H29=ko.computed((()=>this.G29()/this.G15()*100)),this.G35=ko.computed((()=>this.G29()+this.G22())),this.G36=ko.computed((()=>this.G35()/60)),this.H35=ko.computed((()=>this.G35()/this.G15()*100)),this.G37=ko.computed((()=>this.H35()*this.G17()/this.D16()/100)),this.K22=ko.numericObservable(0),this.K23=ko.numericObservable(0),this.K24=ko.numericObservable(0),this.K25=ko.numericObservable(0),this.K26=ko.numericObservable(0),this.K26text=ko.observable("Other"),this.K27=ko.numericObservable(0),this.K27text=ko.observable("Other"),this.L22=ko.computed((()=>this.K22()/this.G15()*100)),this.L23=ko.computed((()=>this.K23()/this.G15()*100)),this.L24=ko.computed((()=>this.K24()/this.G15()*100)),this.L25=ko.computed((()=>this.K25()/this.G15()*100)),this.L26=ko.computed((()=>this.K26()/this.G15()*100)),this.L27=ko.computed((()=>this.K27()/this.G15()*100)),this.K35=ko.computed((()=>this.K22()+this.K23()+this.K24()+this.K25()+this.K26()+this.K27())),this.K36=ko.computed((()=>this.K35()/60)),this.L35=ko.computed((()=>this.K35()/this.G15()*100)),this.K37=ko.computed((()=>this.L35()*this.G17()/this.D16()/100)),this.C42=ko.numericObservable(0),this.C43=ko.numericObservable(0),this.C44=ko.numericObservable(0),this.D42=ko.computed((()=>this.C42()/this.G15()*100)),this.D43=ko.computed((()=>this.C43()/this.G15()*100)),this.D44=ko.computed((()=>this.C44()/this.G15()*100)),this.C46=ko.computed((()=>this.C42()+this.C43()+this.C44())),this.C46hours=ko.computed((()=>this.C46()/60)),this.D46=ko.computed((()=>this.C46()/this.G15()*100)),this.G42=ko.numericObservable(0),this.G43=ko.numericObservable(0),this.G44=ko.numericObservable(0),this.H42=ko.computed((()=>this.G42()/this.G15()*100)),this.H43=ko.computed((()=>this.G43()/this.G15()*100)),this.H44=ko.computed((()=>this.G44()/this.G15()*100)),this.G46=ko.computed((()=>this.G42()+this.G43()+this.G44())),this.G46hours=ko.computed((()=>this.G46()/60)),this.H46=ko.computed((()=>this.G46()/this.G15()*100)),this.G51=ko.numericObservable(0),this.G52=ko.numericObservable(0),this.G53=ko.numericObservable(0),this.H51=ko.computed((()=>this.G51()/this.G17()*100)),this.H52=ko.computed((()=>this.G52()/this.G17()*100)),this.H53=ko.computed((()=>this.G53()/this.G17()*100)),this.G57=ko.computed((()=>this.G51()+this.G52()+this.G53())),this.H57=ko.computed((()=>this.G57()/this.G17()*100)),this.K51=ko.numericObservable(0),this.K52=ko.numericObservable(0),this.K53=ko.numericObservable(0),this.K54=ko.numericObservable(0),this.K55=ko.numericObservable(0),this.L51=ko.computed((()=>this.K51()/this.G17()*100)),this.L52=ko.computed((()=>this.K52()/this.G17()*100)),this.L53=ko.computed((()=>this.K53()/this.G17()*100)),this.L54=ko.computed((()=>this.K54()/this.G17()*100)),this.L55=ko.computed((()=>this.K55()/this.G17()*100)),this.K57=ko.computed((()=>this.K51()+this.K52()+this.K53()+this.K54()+this.K55())),this.L57=ko.computed((()=>this.K57()/this.G17()*100)),this.K59=ko.computed((()=>this.L35()/100*this.G17()+this.K57()+this.K57()*this.L35()/100)),this.L59=ko.computed((()=>this.K59()/this.G17()*100)),this.G59=ko.computed((()=>this.H35()/100*this.G17()-this.K57()*this.H35()/100-this.K57()*this.L35()/100+this.G57())),this.H59=ko.computed((()=>this.G59()/this.G17()*100)),this.C59=ko.computed((()=>this.D35()/100*this.G17()-this.K57()*this.D35()/100-this.K57()*this.L35()/100-this.G57())),this.D59=ko.computed((()=>this.C59()/this.G17()*100)),this.D64=ko.computed((()=>this.C35()-this.C46())),this.D65=ko.computed((()=>this.D64()/this.G15()*100)),this.H64=ko.computed((()=>this.G35()-this.G42()-this.G43())),this.H65=ko.computed((()=>this.H64()/this.G15()*100)),this.L64=ko.computed((()=>this.K35()+this.C42()+this.C43()+this.G42()+this.G43())),this.L65=ko.computed((()=>this.L64()/this.G15()*100)),this.D68=ko.computed((()=>this.C59()-this.D46()/100*this.C59())),this.D69=ko.computed((()=>this.D68()/this.G17()*100)),this.H68=ko.computed((()=>this.G59()-this.H46()/100*this.G59())),this.H69=ko.computed((()=>this.H68()/this.G17()*100)),this.L68=ko.computed((()=>this.K59()+this.H46()/100*this.G59()+this.D46()/100*this.C59())),this.L69=ko.computed((()=>this.L68()/this.G17()*100)),this.J17=ko.computed((()=>this.G15()-(this.C35()+this.G35()+this.K35())))}function submissionsModel(){this.submissions=ko.observableArray([]),this.removeSubmission=function(t){var e=JSON.parse(localStorage.getItem("Session")||"{}");delete e[t.submissionID],localStorage.setItem("Session",JSON.stringify(e)),loadSubmissionsList()},this.editSubmission=function(t){loadSubmission(t.submissionID)},this.viewSubmission=function(t){return window.open().document.write(JSON.stringify(getSubmission(t))),!1},this.viewRaw=function(t){return window.open().document.write(JSON.stringify(getSubmission(t.submissionID))),!1},this.showDateLocal=function(t){var e=new Date(t);return e.toString("MMMM d, yyyy")+" at "+e.toString("h:mm tt")}}function submissionViewModel(){this.SubmissionID=ko.observable(),this.Class=ko.observable(),this.Teacher=ko.observable(),this.ClassDuration=ko.numericObservable(0),this.Observer=ko.observable(),this.ClassSize=ko.numericObservable(0),this.StartTime=ko.observable(),this.EndTime=ko.observable(),this.LastUpdated=ko.observable(),this.IsSubmitted=ko.observable(),this.SubmissionItems=ko.observable(),this.clearValues=function(){this.SubmissionID(Math.round(5e3*Math.random())),this.Class("CLASS"),this.Teacher("TEACHER"),this.ClassDuration(4),this.Observer("OBSERVER"),this.ClassSize(4),this.StartTime((new Date).toISOString()),this.EndTime(void 0),this.LastUpdated((new Date).toISOString()),this.IsSubmitted(),this.SubmissionItems([])}}function isValidRequiredField(t){var e=$(t),i=$.trim(e.val());return 0==i.length?(e.closest(".control-group").addClass("error"),e.parent().find("span.help-inline").html("This is a required field")):(e.closest(".control-group").removeClass("error"),e.parent().find("span.help-inline").html("")),i.length>0}function isValidRequiredDropdown(t){var e=$(t+" option:selected"),i=$.trim(e.val());return 0==i.length?(e.closest(".control-group").addClass("error"),e.parent().find("span.help-inline").html("This is a required field")):(e.closest(".control-group").removeClass("error"),e.parent().find("span.help-inline").html("")),i.length>0}function isValidRequiredNumericField(t){var e=$(t),i=$.trim(e.val()),s=!$.isNumeric(i)||$.isNumeric(i)&&i<=0;return s?(e.closest(".control-group").addClass("error"),e.parent().find("span.help-inline").html("Enter a number greater than zero")):(e.closest(".control-group").removeClass("error"),e.parent().find("span.help-inline").html("")),!s}function startNewActivity(){disableEnterActivity(),enableEnterActivity()}function disableEnterActivity(){$("#enterActivity").addClass("disabled").attr("disabled","disabled")}function enableEnterActivity(){$("#enterActivity").removeClass("disabled").removeAttr("disabled")}function isPastActivitySubmissionThreshold(){return((new Date).getTime()-ActivityManager.currentActivityStartTime)/1e3>=ACTIVITYSUBMISSIONTHRESHOLD}function getSubmission(t){return(JSON.parse(localStorage.getItem("Session"))||"{}")[t]||{}}function getSubmissionItems(t){return(JSON.parse(localStorage.getItem("Session"))||"{}")[t].SubmissionItems||[]}function loadSubmission(t){$.when(getSubmission(t),getSubmissionItems(t)).then(((t,e)=>{ko.mapping.fromJSON(t,{},ActivityManager.currentSubmissionVm),ActivityManager.currentActivityEditVM.items([]),ActivityManager.currentActivityEditVM.items(ko.utils.arrayMap(e,(i=>(console.log(i.StartTime),new ActivityItemEdit(t.SubmissionID,e.indexOf(i),ActivityManager.currentActivityEditVM.categoryList[i.CategoryID-1],_.find(ActivityManager.currentActivityEditVM.categoryList[i.CategoryID-1].Subcategories,(t=>t.SubcategoryID==i.SubcategoryID)),i.Description,moment(i.StartTime).format("h:mm:ss A"),moment(i.EndTime).format("h:mm:ss A"),toHHMMSS(i.Duration),ActivityManager.currentActivityEditVM.categoryList))))),$("#observationEditForm textarea[data-maxsize]"),$("#landing").fadeOut(FADEINTERVAL,(()=>{$("#observationEditForm").fadeIn(FADEINTERVAL)}))})),ko.mapping.fromJSON(JSON.parse(localStorage.getItem("Session"))[t],{},ActivityManager.currentSubmissionVm)}$(document).ready((()=>{ActivityManager.currentActivityTimer=new ActivityTimer,ActivityManager.currentCategory=new Category(CATEGORIES),ko.applyBindings(ActivityManager.currentCategory,$("#observationEntryForm")[0]),ActivityManager.baseCategory=ActivityManager.currentCategory.category(),ActivityManager.currentActivityEditVM=new ActivityEditVM,ko.applyBindings(ActivityManager.currentActivityEditVM,$("#observationEditForm")[0]),ActivityManager.currentActivityEditVM.categoryList=CATEGORIES,ActivityManager.currentActivityMonitor=new ActivityMonitor,ko.applyBindings(ActivityManager.currentActivityMonitor,$("#activitySidebar")[0]),$("input").keypress((t=>{if(13==(t.charCode||t.keyCode))return!1})),pages=$.makeArray($(".page")),LASTPAGEINDEX=pages.length-1,$(".popicon").each((function(){$(this).popover()})),$(".popicondown").each((function(){$(this).popover({placement:"bottom"})})),$("#poptimetracker").each((function(){$(this).popover({placement:"left"})})),$("#viewUserGuide").on("click",(t=>{t.preventDefault(),t.stopPropagation(),window.open("Content/UserGuide.pdf","ctatUserGuide")})),$("#endWelcome").on("click",(t=>{t.preventDefault(),t.stopPropagation(),$("#landingWelcome").fadeOut(FADEINTERVAL,(()=>{Object.keys(JSON.parse(localStorage.getItem("Session")||"{}")).length?$("#landingMain").fadeIn(FADEINTERVAL):(showWizard(),$("#observationEntryAlert, #observationEntryAlert2").hide(),ActivityManager.currentSubmissionVm.clearValues(),ActivityManager.currentActivityMonitor.clearActivities(),ActivityManager.currentActivityEditVM.items([]),$("#startObservationReady").fadeIn(FADEINTERVAL,(()=>{$("#infoClass").focus()})))}))})),$("#createNewSubmission").on("click",(t=>{t.preventDefault(),t.stopPropagation(),showWizard(),$("#observationEntryAlert, #observationEntryAlert2").hide(),ActivityManager.currentSubmissionVm.clearValues(),ActivityManager.currentActivityMonitor.clearActivities(),ActivityManager.currentActivityEditVM.items([]),$("#startObservationReady").fadeIn(FADEINTERVAL,(()=>{$("#infoClass").focus()}))})),$("#startObservation").on("click",(t=>{t.preventDefault(),t.stopPropagation(),$("#preObservationEntry").fadeOut(FADEINTERVAL,(()=>{$("#observationEntry").fadeIn(FADEINTERVAL),ActivityManager.currentActivityStartTime=(new Date).getTime(),ActivityManager.currentActivityTimer.start()}))})),$("#startObservationReady").on("click",(t=>{t.preventDefault(),t.stopPropagation();var e=isValidRequiredField("#infoClass"),i=isValidRequiredField("#infoTeacher"),s=isValidRequiredNumericField("#infoTotalTime"),r=isValidRequiredField("#infoObserver"),a=isValidRequiredNumericField("#infoClassSize");if(e&&i&&s&&r&&a){$("#observationDetailsAlert").fadeOut(FADEINTERVAL),$("#observationDetails").fadeOut(FADEINTERVAL);var o=JSON.parse(localStorage.getItem("Session")||"{}");o[ActivityManager.currentSubmissionVm.SubmissionID()]=JSON.parse(ko.mapping.toJSON(ActivityManager.currentSubmissionVm)),localStorage.setItem("Session",JSON.stringify(o)),ko.mapping.fromJS(o[ActivityManager.currentSubmissionVm.SubmissionID()],{},ActivityManager.currentSubmissionVm),$("#observationDetails").fadeOut(FADEINTERVAL,(()=>{ActivityManager.currentActivityMonitor.className(ActivityManager.currentSubmissionVm.Class()),ActivityManager.currentActivityMonitor.teacherName(ActivityManager.currentSubmissionVm.Teacher()),$("#preObservationEntry").fadeIn(FADEINTERVAL),startNewActivity()}))}else $("#observationDetailsAlert").fadeIn(FADEINTERVAL)})),$("#enterActivity").on("click",(t=>{if(t.preventDefault(),t.stopPropagation(),isPastActivitySubmissionThreshold()){var e=JSON.parse(localStorage.getItem("Session")||"{}"),i=e[ActivityManager.currentSubmissionVm.SubmissionID()].SubmissionItems||[];i.push({CategoryID:ActivityManager.currentCategory.category().CategoryID,SubcategoryID:ActivityManager.currentCategory.subcategory().SubcategoryID,Description:ActivityManager.currentCategory.notes(),Duration:1e3*Math.round(((new Date).getTime()-ActivityManager.currentActivityStartTime)/1e3),StartTime:ActivityManager.currentActivityStartTime,EndTime:(new Date).getTime()}),e[ActivityManager.currentSubmissionVm.SubmissionID()].SubmissionItems=i,localStorage.setItem("Session",JSON.stringify(e)),ActivityManager.currentActivityMonitor.addActivity(ActivityManager.currentCategory.category(),ActivityManager.currentCategory.subcategory(),moment(ActivityManager.currentActivityTimer.milliseconds).subtract("minutes",(new Date).getTimezoneOffset()).format("h:mm:ss")),ActivityManager.currentActivityStartTime=(new Date).getTime(),ActivityManager.currentCategory.category(ActivityManager.baseCategory),ActivityManager.currentCategory.notes(""),$("#entryNotesStatus").html("0").css("color","black"),$("html, body").animate({scrollTop:0},"fast")}})),$("#endObservation, #endObservation2").on("click",(t=>{t.preventDefault(),t.stopPropagation();var e=JSON.parse(localStorage.getItem("Session")||"{}"),i=e[ActivityManager.currentSubmissionVm.SubmissionID()].SubmissionItems||[];i.push({CategoryID:ActivityManager.currentCategory.category().CategoryID,SubcategoryID:ActivityManager.currentCategory.subcategory().SubcategoryID,Description:ActivityManager.currentCategory.notes(),Duration:1e3*Math.round(((new Date).getTime()-ActivityManager.currentActivityStartTime)/1e3),StartTime:ActivityManager.currentActivityStartTime,EndTime:(new Date).getTime()}),e[ActivityManager.currentSubmissionVm.SubmissionID()].SubmissionItems=i,localStorage.setItem("Session",JSON.stringify(e)),ActivityManager.currentCategory.category(ActivityManager.baseCategory),ActivityManager.currentCategory.notes(""),$("#entryNotesStatus").html("0").css("color","black"),ActivityManager.currentActivityEditVM.items(ko.utils.arrayMap(e[ActivityManager.currentSubmissionVm.SubmissionID()].SubmissionItems,(t=>new ActivityItemEdit(ActivityManager.currentSubmissionVm.SubmissionID,t.SubmissionItemID,ActivityManager.currentActivityEditVM.categoryList[t.CategoryID-1],_.find(ActivityManager.currentActivityEditVM.categoryList[t.CategoryID-1].Subcategories,(e=>e.SubcategoryID==t.SubcategoryID)),t.Description,moment(t.StartTime).format("h:mm:ss A"),moment(t.EndTime).format("h:mm:ss A"),toHHMMSS(t.Duration),ActivityManager.currentActivityEditVM.categoryList)))),$("#observationEditForm textarea[data-maxsize]"),$("#observationEntry").fadeOut(FADEINTERVAL,(()=>{$("#submissionPages").hide(),$("#observationEditForm").fadeIn(FADEINTERVAL)}))})),$("#finishEditing").on("click",(t=>{t.preventDefault(),t.stopPropagation(),$("#observationEditForm").fadeOut(FADEINTERVAL,(()=>{$("#submissionPages").hide(),loadSubmissionsList(),$("#landing").fadeIn(FADEINTERVAL)}))})),initLanding(),$("#help").on("click",(t=>{t.preventDefault(),t.stopPropagation(),$("#helpMessage").modal("show")})),$("#about").on("click",(t=>{t.preventDefault(),t.stopPropagation(),$("#aboutMessage").modal("show")})),$("#home, #scenarioRow").on("click",(t=>{t.preventDefault(),t.stopPropagation(),saveVM(),showLanding()})),$("#edit").on("click",(t=>{t.preventDefault(),t.stopPropagation(),saveVM(),navigate(1)})),$("#goSave, #saveMenu").on("click",(t=>{t.preventDefault(),t.stopPropagation(),saveVM()})),$("#editProfile, #editProfileMenu").on("click",(t=>{t.preventDefault(),$("#landing").is(":hidden")&&$("#userInformation").is(":hidden")&&saveVM(),showUserInformation()})),$("#submitScenario").on("click",(t=>{t.preventDefault(),t.stopPropagation(),ActivityManager.currentVM.IsSubmitted=!0,saveVM(),showLanding()})),appViewModel.prototype.toJSON=function(){var t=ko.toJS(this);return t.D5=t.D5.toString("hh:mm tt"),t.D6=t.D6.toString("hh:mm tt"),t.D10=t.D10.toString("hh:mm tt"),t.D11=t.D11.toString("hh:mm tt"),t},ko.bindingHandlers.timePicker={init:function(t,e,i){i().jqDatePickerOptions;var s=e(),r=$(t);ko.utils.registerEventHandler(t,"change",(()=>{s(r.timeEntry("getTime"))})),ko.utils.domNodeDisposal.addDisposeCallback(t,(()=>{r.datepicker("destroy")}))},update:function(t,e){var i=ko.utils.unwrapObservable(e()),s=$(t);s.timeEntry("getTime"),s.timeEntry("setTime",i)}},ko.numericObservable=function(t){var e=ko.observable(t);return ko.dependentObservable({read:function(){return e()},write:function(t){isNaN(t)||(t=Math.abs(t));var i=parseFloat(t);e(isNaN(i)?0:Math.abs(i))}})},ActivityManager.currentSubmissionVm=new submissionViewModel,ko.applyBindings(ActivityManager.currentSubmissionVm,$("#observationDetails")[0])}));